# -*- coding: utf-8 -*-
"""Äá»’ ÃN TÃ“M Táº®T VÄ‚N Báº¢N Báº¢NG TRÃ TUá»† NHÃ‚N Táº O DÃ™NG MÃ” HÃŒNH T5 VÃ€ Dá»® LIá»†U CNN/DAILYMAIL.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/199qe5yS1RpPKqKQcer2HgQwMk2nzOdrv
"""

# CÃ i Ä‘áº·t thÆ° viá»‡n cáº§n thiáº¿t
!pip install transformers datasets

!pip install numpy

pip install --upgrade datasets

from transformers import T5ForConditionalGeneration, T5Tokenizer

# Táº£i mÃ´ hÃ¬nh vÃ  tokenizer
model_name = "t5-small"  # Báº¡n cÃ³ thá»ƒ Ä‘á»•i thÃ nh "t5-base" hoáº·c "t5-large"
tokenizer = T5Tokenizer.from_pretrained(model_name)
model = T5ForConditionalGeneration.from_pretrained(model_name)

from datasets import load_dataset

# Táº£i dá»¯ liá»‡u CNN/DAILY MAIL
dataset = load_dataset("cnn_dailymail", "3.0.0")

from transformers import BartTokenizer

# Táº£i tokenizer
tokenizer = BartTokenizer.from_pretrained("facebook/bart-large-cnn")

# KÃ­ch hoáº¡t GPU
import torch
device = "cuda" if torch.cuda.is_available() else "cpu"
model = model.to(device)

# ÄÆ°a input_ids vÃ o GPU náº¿u cÃ³
input_ids = input_ids.to(device)

# Láº¥y má»™t máº«u tá»« dá»¯ liá»‡u Ä‘á»ƒ thá»­ nghiá»‡m
sample_text = dataset['train'][0]['article']  # Láº¥y bÃ i bÃ¡o Ä‘áº§u tiÃªn tá»« táº­p train
print("VÄƒn báº£n gá»‘c:", sample_text)

# ThÃªm prefix "summarize: " vÃ o vÄƒn báº£n
input_text = "summarize: " + sample_text

# Tokenize dá»¯ liá»‡u
input_ids = tokenizer.encode(input_text, return_tensors="pt", max_length=512, truncation=True)

from transformers import BartForConditionalGeneration, BartTokenizer

# Táº£i mÃ´ hÃ¬nh vÃ  tokenizer
model = BartForConditionalGeneration.from_pretrained("facebook/bart-large-cnn")
tokenizer = BartTokenizer.from_pretrained("facebook/bart-large-cnn")

# Generate summary
summary_ids = model.generate(input_ids, max_length=150, min_length=40, length_penalty=2.0, num_beams=4, early_stopping=True)

# Giáº£i mÃ£ káº¿t quáº£ tÃ³m táº¯t
summary = tokenizer.decode(summary_ids[0], skip_special_tokens=True)
print("TÃ³m táº¯t:", summary)

for i in range(3):  # Láº·p qua 3 máº«u
    sample_text = dataset['train'][i]['article']
    input_text = "summarize: " + sample_text
    input_ids = tokenizer.encode(input_text, return_tensors="pt", max_length=512, truncation=True).to(device)
    summary_ids = model.generate(input_ids, max_length=150, min_length=40, length_penalty=2.0, num_beams=4, early_stopping=True)
    summary = tokenizer.decode(summary_ids[0], skip_special_tokens=True)
    print(f"VÄƒn báº£n gá»‘c {i+1}:", sample_text)
    print(f"TÃ³m táº¯t {i+1}:", summary)
    print("-" * 80)

pip install streamlit transformers

import ipywidgets as widgets
from google.colab import files
from IPython.display import display, clear_output

# Danh sÃ¡ch ngÃ´n ngá»¯ giao diá»‡n (nhiá»u nÆ°á»›c)
ui_languages = [
    ('ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t', 'vi'),
    ('ğŸ‡ºğŸ‡¸ English', 'en'),
    ('ğŸ‡¨ğŸ‡³ ä¸­æ–‡ (Chinese)', 'zh'),
    ('ğŸ‡ªğŸ‡¸ EspaÃ±ol', 'es'),
    ('ğŸ‡«ğŸ‡· FranÃ§ais', 'fr'),
    ('ğŸ‡©ğŸ‡ª Deutsch', 'de'),
    ('ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª (Japanese)', 'ja'),
    ('ğŸ‡°ğŸ‡· í•œêµ­ì–´ (Korean)', 'ko'),
    ('ğŸ‡¹ğŸ‡­ à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ (Thai)', 'th'),
    ('ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹ (Russian)', 'ru'),
    ('ğŸ‡§ğŸ‡· PortuguÃªs', 'pt')
]

# Danh sÃ¡ch ngÃ´n ngá»¯ láº­p trÃ¬nh (cÃ³ thá»ƒ thÃªm/bá»›t)
prog_languages = [
    'Python', 'JavaScript', 'C++', 'Java', 'C#', 'Go', 'Ruby', 'PHP', 'Other'
]

# Widget chá»n ngÃ´n ngá»¯ giao diá»‡n
ui_lang_dropdown = widgets.Dropdown(
    options=ui_languages,
    value='vi',
    description='ğŸŒ Giao diá»‡n:',
    style={'description_width':'110px'},
    layout=widgets.Layout(width='60%')
)

# Widget chá»n loáº¡i ngÃ´n ngá»¯ láº­p trÃ¬nh
prog_lang_dropdown = widgets.Dropdown(
    options=prog_languages,
    value='Python',
    description='ğŸ’» Láº­p trÃ¬nh:',
    style={'description_width':'110px'},
    layout=widgets.Layout(width='60%')
)

# Widget nháº­p ná»™i dung
text_box = widgets.Textarea(
    value='',
    placeholder='âœï¸ Nháº­p ná»™i dung táº¡i Ä‘Ã¢y...',
    description='ğŸ“ Ná»™i dung:',
    layout=widgets.Layout(width='100%', height='120px'),
    style={'description_width':'110px'}
)

# NÃºt upload file
upload_button = widgets.Button(
    description="ğŸ“‚ Chá»n file Ä‘á»ƒ upload",
    button_style='info', # 'primary', 'success', 'info', 'warning', 'danger'
    layout=widgets.Layout(width='220px')
)

# NÃºt gá»­i
submit_button = widgets.Button(
    description="ğŸš€ Gá»­i",
    button_style='success',
    layout=widgets.Layout(width='120px')
)

# Custom HTML cho tiÃªu Ä‘á» (mÃ u mÃ¨)
colorful_title = widgets.HTML("""
    <h2 style='
        background: linear-gradient(90deg, #ff9800, #f44336, #2196f3, #4caf50, #9c27b0);
        color: white;
        padding: 18px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        letter-spacing: 2px;
    '>
      ğŸ‰ Táº£i file, nháº­p ná»™i dung & chá»n ngÃ´n ngá»¯ ğŸŒ
    </h2>
""")

output = widgets.Output()
uploaded_files = {}

def on_upload_clicked(b):
    with output:
        clear_output()
        display(widgets.HTML('<span style="color:#2196f3;font-weight:bold">Äang táº£i file lÃªn, vui lÃ²ng chá»...</span>'))
        uploaded = files.upload()
        if uploaded:
            display(widgets.HTML('<span style="color:green;font-weight:bold">ÄÃ£ táº£i lÃªn thÃ nh cÃ´ng cÃ¡c file:</span>'))
            for fn in uploaded.keys():
                display(widgets.HTML(f'<li style="color:#4caf50">{fn}</li>'))
            global uploaded_files
            uploaded_files = uploaded
        else:
            display(widgets.HTML('<span style="color:orange">KhÃ´ng cÃ³ file nÃ o Ä‘Æ°á»£c chá»n.</span>'))

def on_submit_clicked(b):
    with output:
        clear_output()
        display(widgets.HTML(f"""
            <div style='border:2px dashed #4caf50; border-radius:12px; padding:16px; margin-bottom:10px; background:#f7fff7'>
                <b style="color:#f44336">Ná»™i dung báº¡n vá»«a nháº­p:</b>
                <pre style="background:#23272e; color:#fff; border-radius:8px; padding:10px">{text_box.value}</pre>
                <span style="color:#2196f3"><b>NgÃ´n ngá»¯ giao diá»‡n Ä‘Ã£ chá»n:</b> {dict(ui_languages)[ui_lang_dropdown.value]}</span><br>
                <span style="color:#9c27b0"><b>NgÃ´n ngá»¯ láº­p trÃ¬nh Ä‘Ã£ chá»n:</b> {prog_lang_dropdown.value}</span>
            </div>
        """))
        if uploaded_files:
            display(widgets.HTML('<b style="color:#009688">CÃ¡c file Ä‘Ã£ upload:</b>'))
            for fn in uploaded_files.keys():
                display(widgets.HTML(f'<li style="color:#607d8b">{fn}</li>'))
        else:
            display(widgets.HTML('<span style="color:orange">ChÆ°a upload file nÃ o.</span>'))

upload_button.on_click(on_upload_clicked)
submit_button.on_click(on_submit_clicked)

# Hiá»ƒn thá»‹ giao diá»‡n mÃ u mÃ¨
display(widgets.VBox([
    colorful_title,
    ui_lang_dropdown,
    prog_lang_dropdown,
    text_box,
    widgets.HBox([upload_button, submit_button]),
    output
], layout=widgets.Layout(border='3px solid #9c27b0', border_radius='18px', padding='18px', box_shadow='0 4px 16px #b39ddb44')))

!pip install pyngrok

!pip show streamlit
!pip show transformers
!pip show pyngrok

!rm -rf /root/.ngrok2/ngrok.yml

!wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip
!unzip ngrok-stable-linux-amd64.zip

!ngrok config add-authtoken 2xUIVFYU2YvFW3y6YFfgXHSFYx1_3JUNxFUJqN1cZazyR8XTn

!./ngrok http 8501

!streamlit run app.py &>/dev/null&

!ls

import streamlit as st
from transformers import AutoTokenizer, AutoModelForSeq2SeqLM
import time

# --- Cáº¥u hÃ¬nh giao diá»‡n ---
st.set_page_config(page_title="TÃ³m Táº¯t VÄƒn Báº£n", page_icon="ğŸ“", layout="centered")

# --- CSS LED RGB Ä‘á»™ng + hiá»‡u á»©ng Liquid Glass ---
st.markdown("""
    <style>
    html, body {
        font-family: 'Segoe UI', 'Roboto', sans-serif;
        margin: 0;
        padding: 0;
        height: 100%;
        background: linear-gradient(270deg, #ff4b4b, #ffcc00, #00ffcc, #0099ff, #cc00ff);
        background-size: 1000% 1000%;
        animation: rgbBackground 20s ease infinite;
    }

    @keyframes rgbBackground {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .block-container {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 25px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
        padding: 3rem;
        margin-top: 4rem;
    }

    .stTextArea textarea {
        font-size: 16px !important;
        padding: 15px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.15);
        color: #000;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .stButton button {
        background-color: #ff4b4b;
        color: white;
        border-radius: 12px;
        padding: 12px 30px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        box-shadow: 0 4px 14px rgba(255, 75, 75, 0.4);
    }

    .stButton button:hover {
        background-color: #e03a3a;
        box-shadow: 0 6px 20px rgba(255, 75, 75, 0.6);
    }

    .title-style {
        color: #ffffff;
        text-align: center;
        font-size: 36px;
        font-weight: bold;
        margin-bottom: 1rem;
        text-shadow: 0px 0px 10px #000000;
    }

    .summary-style {
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(10px);
        padding: 20px;
        border-radius: 12px;
        font-size: 18px;
        color: #000;
        margin-top: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    </style>
""", unsafe_allow_html=True)

# --- Load mÃ´ hÃ¬nh T5 ---
@st.cache_resource
def load_model_tokenizer():
    tokenizer = AutoTokenizer.from_pretrained("VietAI/vit5-base-vietnews-summarization")
    model = AutoModelForSeq2SeqLM.from_pretrained("VietAI/vit5-base-vietnews-summarization")
    return tokenizer, model

tokenizer, model = load_model_tokenizer()

# --- HÃ m tÃ³m táº¯t ---
def summarize_text_vi(text):
    input_ids = tokenizer(text, return_tensors="pt", max_length=512, truncation=True).input_ids
    summary_ids = model.generate(
        input_ids,
        max_length=100,
        min_length=20,
        length_penalty=2.0,
        num_beams=4,
        early_stopping=True
    )
    output = tokenizer.decode(summary_ids[0], skip_special_tokens=True)
    return output

# --- Giao diá»‡n chÃ­nh ---
st.markdown("<h1 class='title-style'>ğŸ“ á»¨ng Dá»¥ng TÃ³m Táº¯t VÄƒn Báº£n</h1>", unsafe_allow_html=True)
st.markdown("### ğŸ“„ Nháº­p ná»™i dung bÃªn dÆ°á»›i Ä‘á»ƒ tiáº¿n hÃ nh tÃ³m táº¯t:")

input_text = st.text_area("âœï¸ Ná»™i dung vÄƒn báº£n:", height=200, placeholder="Nháº­p vÄƒn báº£n táº¡i Ä‘Ã¢y...")

if st.button("ğŸš€ TÃ³m táº¯t ngay!"):
    if input_text.strip():
        with st.spinner("â³ Äang tÃ³m táº¯t, vui lÃ²ng Ä‘á»£i..."):
            progress_bar = st.progress(0)
            for percent_complete in range(0, 101, 10):
                time.sleep(0.03)
                progress_bar.progress(percent_complete)

            try:
                summary = summarize_text_vi(input_text)
                st.success("âœ… Káº¿t quáº£ tÃ³m táº¯t:")
                st.markdown(f"<div class='summary-style'>{summary}</div>", unsafe_allow_html=True)
            except Exception as e:
                st.error(f"âŒ Lá»—i khi tÃ³m táº¯t: {str(e)}")
    else:
        st.warning("âš ï¸ Vui lÃ²ng nháº­p vÄƒn báº£n trÆ°á»›c khi nháº¥n nÃºt.")

!pip install Sentencepiece

pip install streamlit transformers torch

!pip install underthesea

!streamlit run app.py

!streamlit run app.py --server.port 8501 --server.headless true &>/dev/null&

!lsof -i:8501

!ps aux | grep streamlit

from pyngrok import ngrok

# Má»Ÿ cá»•ng ngrok Ä‘á»ƒ táº¡o URL cÃ´ng khai
public_url = ngrok.connect(8501)  # 8501 lÃ  cá»•ng máº·c Ä‘á»‹nh cá»§a Streamlit
print("Má»Ÿ á»©ng dá»¥ng táº¡i:", public_url)